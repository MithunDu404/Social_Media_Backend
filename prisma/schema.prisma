// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// *********************************

enum NotificationReason {
  FOLLOW
  POST_LIKE
  COMMENT_LIKE
  REPLY_LIKE
  COMMENT
  REPLY
  MESSAGE
}

// *********************************

model User {
  id          Int       @id @default(autoincrement())
  user_name   String       
  password    String      
  email       String       @unique
  phone       String?
  dob         DateTime? 
  location    String? 
  about       String?
  picture_url String?   // UploadThing URL

  posts       Post[]
  comments    Comment[]
  replies     Reply[]

  postLikes   PostLikes[]
  commentLikes CommentLikes[]
  replyLikes  ReplyLikes[]

  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")

  notificationsCreated Notification[] @relation("CreatedNotifications")
  notificationsReceived Notification[] @relation("ReceivedNotifications")

  followers   Follow[] @relation("UserFollowers")
  followings  Follow[] @relation("UserFollowings")
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  blog      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user_id   Int

  user      User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  medias    Media[]
  comments  Comment[]
  likes     PostLikes[]
}

model Media {
  id           Int      @id @default(autoincrement())
  url          String    // UploadThing URL
  content_type String
  size         Int?
  createdAt    DateTime @default(now())
  
  post_id      Int
  post         Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
}

model Comment {
  id         Int       @id @default(autoincrement())
  comment    String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  
  post_id    Int
  user_id    Int

  post       Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [user_id], references: [id])
  replies    Reply[]
  likes      CommentLikes[]
}

model Reply {
  id         Int      @id @default(autoincrement())
  reply      String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  comment_id Int
  user_id    Int

  comment    Comment @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  user       User    @relation(fields: [user_id], references: [id])
  likes      ReplyLikes[]
}

// *********************************

model PostLikes {
  post_id  Int
  user_id  Int
  likedAt  DateTime @default(now())

  post     Post @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user     User @relation(fields: [user_id], references: [id])

  @@id([post_id, user_id])
}

model CommentLikes {
  comment_id Int
  user_id    Int
  likedAt    DateTime @default(now())

  comment    Comment @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  user       User    @relation(fields: [user_id], references: [id])

  @@id([comment_id, user_id])
}

model ReplyLikes {
  reply_id Int
  user_id  Int
  likedAt  DateTime @default(now())

  reply    Reply @relation(fields: [reply_id], references: [id], onDelete: Cascade)
  user     User   @relation(fields: [user_id], references: [id])

  @@id([reply_id, user_id])
}

// *********************************

model Follow {
  follower_id Int // user who is following
  following_id Int // user who is being followed
  followedAt  DateTime @default(now())

  follower User @relation("UserFollowers", fields: [follower_id], references: [id])
  following User @relation("UserFollowings", fields: [following_id], references: [id])

  @@id([follower_id, following_id])
}

model Message {
  id         Int      @id @default(autoincrement())
  sender_id  Int
  receiver_id Int
  message    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  is_read    Boolean  @default(false)

  sender     User @relation("SentMessages", fields: [sender_id], references: [id])
  receiver   User @relation("ReceivedMessages", fields: [receiver_id], references: [id])
}

model Notification {
  id          Int  @id @default(autoincrement())
  creator_id  Int
  receiver_id Int
  reason      NotificationReason
  createdAt   DateTime @default(now())
  is_read     Boolean   @default(false)

  creator     User @relation("CreatedNotifications", fields: [creator_id], references: [id])
  receiver    User @relation("ReceivedNotifications", fields: [receiver_id], references: [id])
}
